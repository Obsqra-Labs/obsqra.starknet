# OODS Root Cause - FOUND! üéØ

**Date**: 2026-01-26  
**Status**: Critical mismatch identified

---

## üö® CRITICAL MISMATCH FOUND

### Layout Mismatch ‚ùå
- **Example (recursive)**: `layout: "recursive"`
- **Ours**: `layout: "small"`
- **Config says**: `INTEGRITY_LAYOUT = "recursive"`

### Builtin Mismatch ‚ùå
- **Example (recursive)**: `bitwise` segment
- **Ours**: `ecdsa` segment (no `bitwise` segment!)
- **Our program uses**: `bitwise` (we changed it)

---

## Root Cause

**The public input generated by `cairo-run` is using `small` layout and `ecdsa` builtin, NOT `recursive` layout and `bitwise` builtin!**

This means:
1. `cairo-run --layout recursive` is **not working** as expected, OR
2. The Cairo program being run is the **wrong one** (using `ecdsa` instead of `bitwise`), OR
3. `cairo-run` is ignoring the `--layout` flag and defaulting to `small`

---

## Evidence

### Our Public Input (from `/tmp/risk_stone_*/risk_public.json`)
```json
{
  "layout": "small",           // ‚ùå Should be "recursive"
  "memory_segments": {
    "ecdsa": {...},            // ‚ùå Should be "bitwise"
    // No "bitwise" segment!
  }
}
```

### Example Public Input (recursive)
```json
{
  "layout": "recursive",       // ‚úÖ Correct
  "memory_segments": {
    "bitwise": {...},          // ‚úÖ Correct
    // No "ecdsa" segment!
  }
}
```

---

## Why This Causes OODS Error

1. **Stone generates proof** using `small` layout + `ecdsa` builtin
2. **Integrity verifier expects** `recursive` layout + `bitwise` builtin
3. **AIR mismatch** ‚Üí Different composition polynomial ‚Üí OODS mismatch

---

## Fix Required

### Option 1: Fix Cairo Execution (Recommended)
Ensure `cairo-run` actually uses `recursive` layout:
- Check if `--layout recursive` flag is being passed correctly
- Verify the Cairo program being run uses `bitwise` (not `ecdsa`)
- Check if `cairo-run` version supports `recursive` layout

### Option 2: Use Small Layout
If `recursive` layout isn't working with `cairo-run`:
- Change config to `INTEGRITY_LAYOUT = "small"`
- Use **split serialization** (not monolith) for small layout
- Keep `ecdsa` builtin in program

### Option 3: Check Cairo Program
Verify we're running the correct program:
- Should be `risk_example_cairo0.cairo` with `bitwise` builtin
- Not an old version with `ecdsa` builtin

---

## Next Steps

1. **Check cairo-run command** ‚Üí Verify `--layout recursive` is actually used
2. **Verify Cairo program** ‚Üí Ensure it uses `bitwise` (not `ecdsa`)
3. **Test with recursive** ‚Üí See if `cairo-run` supports recursive layout
4. **Fix or switch** ‚Üí Either fix recursive or switch to small + split

---

**Status**: üéØ Root cause identified! Layout and builtin mismatch between generated public input and Integrity's expectations.
